#!/usr/bin/env bash

book=0

if [[ $# -eq 0 ]]
then
    book=1
fi

if [[ $book == 1 ]]
then
    args=(chapter*/chapter*.md appendix*/appendix*.md)
    out="book.pdf"
else
    args="$@"
    out="${1%.*}.pdf"
fi

for path in "${args[@]}"
do
    names+=("${path%.*}.md")
done

if [[ $book == 1 ]]
then
    echo "Combining"
    for path in "${names[@]}"
    do
        echo $path
    done
    echo "into $out"
else
    echo "Converting ${names[@]} to $out"
fi

pandoc -t pdf \
       -o "$out" \
       -F pandoc-crossref \
       -M chapters \
       -M title='Foundations of Reinforcement Learning with Applications in Finance' \
       -M author='Ashwin Rao, Tikhon Jelvis' \
       --pdf-engine=xelatex \
       --template templates/latex.template \
       --top-level-division=part \
       $( (( book == 1 )) && printf %s '--toc' ) \
       "${names[@]}"
